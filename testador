#!/usr/bin/zsh
# COMPLETAMENTE FEITO NO CHATGPT

# Fun√ß√£o de ajuda
usage() {
    echo "Uso: $0 -d <diret√≥rio>"
    exit 1
}

# L√™ a flag -d ou --dir
while [[ "$#" -gt 0 ]]; do
    case $1 in
        -d|--dir)
            DIR="$2"
            shift 2
            ;;
        *)
            echo "Op√ß√£o desconhecida: $1"
            usage
            ;;
    esac
done

# Verifica se o diret√≥rio foi fornecido
if [ -z "$DIR" ]; then
    echo "Erro: diret√≥rio n√£o especificado."
    usage
fi

# Verifica se o diret√≥rio existe
if [ ! -d "$DIR" ]; then
    echo "Erro: diret√≥rio '$DIR' n√£o existe."
    exit 1
fi

# Executa os testes no diret√≥rio especificado
(
    cd "$DIR" || exit 1

    if [ ! -x "./a.out" ]; then
        echo "Erro: './a.out' n√£o √© execut√°vel ou n√£o existe."
        exit 1
    fi

    for input_file in input/test_*; do
        test_name=$(basename "$input_file")
        output_file="output/$test_name"

        if [ ! -f "$output_file" ]; then
            echo "Aviso: Arquivo de sa√≠da correspondente '$output_file' n√£o encontrado. Pulando."
            continue
        fi

        echo "üîé Testando $test_name..."
        ./a.out < "$input_file" | diff "$output_file" -
        echo "-------------------------"
    done
)

